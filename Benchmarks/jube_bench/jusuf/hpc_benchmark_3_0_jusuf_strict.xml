<?xml version="1.0" encoding="UTF-8"?>
<jube>

  <!-- HPC-benchmark -->

  <include-path>
    <path>../../jube_config/</path>
  </include-path>


  <benchmark name="hpc_jusuf" outpath="../../../../BenchWork/jube_hpc">

    <parameterset name="nest_version">
      <parameter name="NEST" tag="3|!rng|!2_20|!2_20_1">3</parameter>
      <parameter name="NEST" tag="2_20">2_20</parameter>
      <parameter name="NEST" tag="2_20_1">2_20_1</parameter>
      <parameter name="NEST" tag="rng">rng</parameter>
      <parameter name="BENCHMARK_VERSION" tag="3|!rng|!2_20|!2_20_1">_3</parameter>
      <parameter name="BENCHMARK_VERSION" tag="2_20"></parameter>
      <parameter name="BENCHMARK_VERSION" tag="2_20_1"></parameter>
      <parameter name="BENCHMARK_VERSION" tag="rng">_rng</parameter>
    </parameterset>

    <step name="bench">
      <use>nest_version</use>
      <use from="benchmarks_jusuf.xml">hpc_params</use>
      <use from="dir_config.xml">dir_config</use>
      <use from="system_descriptions.xml">system_jusuf</use>
      <use from="benchmark_systems.xml:hpc_benchmark_3:hpc_benchmark_rng:hpc_benchmark">hpc_benchmark$BENCHMARK_VERSION</use>
      <use from="packages.xml:nest_3:nest_rng:nest_2_20:nest_2_20_1">nest_$NEST</use>
      <use from="packages.xml">nest_base_O3_strict,jemalloc</use>
      <use from="bench_jobs.xml">bench_base_vp,bench_nest_boost,files,sub_bench_job</use>
      <do done_file="$ready_file">$submit_cmd $job_file</do>
    </step>


    <!-- Analyse -->
    <analyser name="analyse_scale_check">
      <use from="bench_jobs.xml">nest_pattern_stdcout</use>      <!-- use existing patternset -->
      <analyse step="bench">
        <file>stdout</file>        <!-- file which should be scanned -->
      </analyse>
    </analyser>

    <!-- Create result table -->
    <result name="result_table">
      <use>analyse_scale_check</use>      <!-- use existing analyser -->
      <table name="hpc" style="csv" sort="number">
        <column>git</column>
        <column>NUMBER_OF_NODES</column>
        <column>TASKS_PER_NODE</column>
        <column>THREADS_PER_TASK</column>
        <column>num_tasks</column>
        <column>NUM_VPS</column>
        <column>SCALE</column>
        <column>PLASTIC</column>
        <column>T_nrns</column>
        <column>T_conns_min</column>
        <column>T_conns_max</column>
        <column>T_conns_sum</column>
        <column>T_ini_min</column>
        <column>T_ini_max</column>
        <column>T_equ</column>
        <column>T_sim</column>
        <column>VSize_nodes_sum</column>
        <column>VSize_mem_sum</column>
        <column>VSize_ini_sum</column>
        <column>VSize_sum</column>
        <column>N_spks_sum</column>
        <column>Rate_sum</column>
        <column>N_nrns</column>
        <column>N_conns_sum</column>
        <column>d_min</column>
        <column>d_max</column>
      </table>
    </result>


  </benchmark>
</jube>
